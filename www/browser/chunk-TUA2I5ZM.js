import{a as g}from"./chunk-2I42IO6W.js";import{c as p,d as a,f as c,h as m,ia as h,k as u,n as l,oa as f,u as v}from"./chunk-WGFYM5RO.js";var r=g("Preferences",{web:()=>import("./chunk-ZEUJMARI.js").then(t=>new t.PreferencesWeb)});var k={development:{name:"development",production:!1,apiBaseUrl:"http://localhost:4200",appName:"HotSOS Mobile (Dev)",mockAuth:!0},qa:{name:"qa",production:!1,apiBaseUrl:"https://qa-api.hotsos.example.com",appName:"HotSOS Mobile (QA)",mockAuth:!0},production:{name:"production",production:!0,apiBaseUrl:"https://api.hotsos.example.com",appName:"HotSOS Mobile",mockAuth:!1}};function w(){let t=typeof globalThis.APP_ENV=="string"?globalThis.APP_ENV:"development";return t in k?t:"development"}var s=k[w()];var d=class t{http=l(f);userKey="session_user";currentUser=v("");userInitials=h(()=>{let e=this.currentUser().trim();return e?e.split(/\s+/).filter(Boolean).map(n=>n[0]?.toUpperCase()??"").join("").slice(0,2):"JW"});loginWithPin(e){if(!navigator.onLine)return p(()=>new Error("Offline: Please check your connection."));let n=s.mockAuth?"/assets/mock/auth.json":`${s.apiBaseUrl}/api/auth/pin`;return this.http.get(n).pipe(m(o=>s.production?[o]:c(500).pipe(a(()=>o))),a(o=>{let i=o.pins.find(y=>y.pin===e);if(!i)throw new Error("Invalid PIN. Please try again.");return{token:i.token,user:i.user}}))}async saveToken(e){await r.set({key:"session_token",value:e})}async saveSession(e,n){await Promise.all([r.set({key:"session_token",value:e}),r.set({key:this.userKey,value:n})]),this.currentUser.set(n)}async getToken(){let{value:e}=await r.get({key:"session_token"});return e}async initSessionUser(){let{value:e}=await r.get({key:this.userKey});this.currentUser.set(e??"")}async clearToken(){await Promise.all([r.remove({key:"session_token"}),r.remove({key:this.userKey})]),this.currentUser.set("")}static \u0275fac=function(n){return new(n||t)};static \u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"})};export{r as a,d as b};
