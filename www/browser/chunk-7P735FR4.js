import{a as z}from"./chunk-RKCA7R7L.js";import{a as L,b as _,c as F,d as E,f as N,g as V,h as T,i as I,k as G}from"./chunk-26UHM24F.js";import{b as O}from"./chunk-TUA2I5ZM.js";import"./chunk-2I42IO6W.js";import{A as r,D as S,I as w,J as x,K as v,P as d,Q as t,R as i,S as l,W as C,X as f,Z as p,aa as s,ba as P,ca as M,ma as y,n as h,o as g,p as u,q as b,ta as k,u as m}from"./chunk-WGFYM5RO.js";import"./chunk-2NFLSA4Y.js";function A(o,n){o&1&&(b(),t(0,"svg",8),l(1,"path",10)(2,"path",11)(3,"path",12),i())}function U(o,n){o&1&&(b(),t(0,"svg",8),l(1,"path",13)(2,"circle",14),i())}function B(o,n){if(o&1){let e=C();t(0,"div",2)(1,"h1")(2,"span"),s(3,"aMaDEUS"),i(),s(4," HotSOS Mobile"),i()(),t(5,"div",3)(6,"h2"),s(7,"Enter your PIN"),i(),t(8,"form",4),f("ngSubmit",function(){g(e);let a=p();return u(a.onPinSubmit())}),t(9,"div",5),l(10,"input",6),t(11,"button",7),f("click",function(){g(e);let a=p();return u(a.showPin.set(!a.showPin()))}),x(12,A,4,0,":svg:svg",8)(13,U,3,0,":svg:svg",8),i()(),t(14,"button",9),s(15),i()()()}if(o&2){let e=p();r(8),d("formGroup",e.pinForm),r(2),d("type",e.showPin()?"text":"password"),w("disabled",e.isLoading()?!0:null),r(2),v(e.showPin()?13:12),r(2),d("disabled",e.pinForm.invalid||e.isLoading()),r(),M(" ",e.isLoading()?"Verifying\u2026":"Continue"," ")}}function j(o,n){o&1&&(b(),t(0,"svg",8),l(1,"path",10)(2,"path",11)(3,"path",12),i())}function q(o,n){o&1&&(b(),t(0,"svg",8),l(1,"path",13)(2,"circle",14),i())}function R(o,n){if(o&1){let e=C();t(0,"div",1)(1,"div",15)(2,"div",16),s(3),i(),t(4,"span",17),s(5),i()(),t(6,"div",3)(7,"h2"),s(8,"Enter your Password"),i(),t(9,"form",4),f("ngSubmit",function(){g(e);let a=p();return u(a.onPasswordSubmit())}),t(10,"div",18),l(11,"input",19),t(12,"button",7),f("click",function(){g(e);let a=p();return u(a.showPassword.set(!a.showPassword()))}),x(13,j,4,0,":svg:svg",8)(14,q,3,0,":svg:svg",8),i()(),t(15,"button",9),s(16),i(),l(17,"div",20),t(18,"button",21),f("click",function(){g(e);let a=p();return u(a.goBack())}),s(19," Back to PIN "),i()()()()}if(o&2){let e=p();r(3),P(e.initials),r(2),P(e.verifiedUser()),r(4),d("formGroup",e.passwordForm),r(2),d("type",e.showPassword()?"text":"password"),w("disabled",e.isLoading()?!0:null),r(2),v(e.showPassword()?14:13),r(2),d("disabled",e.passwordForm.invalid||e.isLoading()),r(),M(" ",e.isLoading()?"Logging in\u2026":"Log In"," "),r(2),d("disabled",e.passwordForm.invalid||e.isLoading())}}var D=class o{step=m("pin");pinForm;passwordForm;verifiedUser=m("");pendingToken="";isLoading=m(!1);showPin=m(!1);showPassword=m(!1);fb=h(I);authService=h(O);errorModal=h(z);router=h(k);constructor(){this.pinForm=this.fb.group({pin:["",[_.required,_.minLength(4),_.pattern("^[0-9]*$")]]}),this.passwordForm=this.fb.group({password:["",[_.required,_.minLength(4)]]})}onPinSubmit(){if(this.pinForm.invalid){this.pinForm.markAllAsTouched(),this.errorModal.show(this.getPinValidationMessage());return}this.isLoading.set(!0),this.authService.loginWithPin(this.pinForm.value.pin).subscribe({next:n=>{this.pendingToken=n.token,this.verifiedUser.set(n.user),this.isLoading.set(!1),this.step.set("password")},error:n=>{this.isLoading.set(!1),this.errorModal.show(n.message||"An error occurred. Please try again."),this.pinForm.get("pin")?.reset()}})}async onPasswordSubmit(){if(this.passwordForm.invalid){this.passwordForm.markAllAsTouched(),this.errorModal.show("Please enter your password.");return}this.isLoading.set(!0),await this.authService.saveSession(this.pendingToken,this.verifiedUser()),this.router.navigate(["/shell/housekeeping"])}goBack(){this.step.set("pin"),this.verifiedUser.set(""),this.pendingToken="",this.passwordForm.reset()}getPinValidationMessage(){let n=this.pinForm.get("pin");return!n||n.hasError("required")?"Please enter PIN.":n.hasError("pattern")?"PIN must contain only numbers.":n.hasError("minlength")?"PIN must be at least 4 digits.":"Please enter a valid PIN."}get initials(){return this.verifiedUser().split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-login"]],decls:3,vars:2,consts:[[1,"login-wrapper"],[1,"pwd-screen"],[1,"brand-header"],[1,"login-content"],[3,"ngSubmit","formGroup"],[1,"input-container","input-container--pin"],["formControlName","pin","placeholder","Enter PIN","inputmode","numeric","autocomplete","off",1,"pin-input",3,"type"],["type","button","tabindex","-1",1,"eye-btn",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","#9ca3af","stroke-width","1.8","stroke-linecap","round","stroke-linejoin","round"],["type","submit",1,"continue-btn",3,"disabled"],["d","M17.94 17.94A10.94 10.94 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94"],["d","M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19"],["d","M1 1l22 22"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"],["cx","12","cy","12","r","3"],[1,"pwd-screen__user"],[1,"pwd-screen__avatar"],[1,"pwd-screen__name"],[1,"input-container","input-container--pwd"],["formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","autocomplete","current-password",1,"pin-input",3,"type"],[2,"width","100%","height","30px"],["type","submit",1,"continue-btn",2,"width","50%","margin","0 auto",3,"click","disabled"]],template:function(e,c){e&1&&(t(0,"div",0),x(1,B,16,6),x(2,R,20,9,"div",1),i()),e&2&&(r(),v(c.step()==="pin"?1:-1),r(),v(c.step()==="password"?2:-1))},dependencies:[y,G,N,L,F,E,T,V],styles:["[_nghost-%COMP%]{display:block;height:100%;background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}.login-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:24px 20px;height:100%;box-sizing:border-box}.brand-header[_ngcontent-%COMP%]{margin-top:40px;margin-bottom:60px}.brand-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:18px;color:#1a1a1a;font-weight:500;margin:0;display:flex;align-items:baseline;gap:8px}.brand-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:22px;font-weight:800;letter-spacing:-.5px;text-transform:uppercase}.login-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.login-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:22px;font-weight:600;color:#1a1a1a;margin-bottom:24px;margin-top:0}.login-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.input-container[_ngcontent-%COMP%]{margin-bottom:24px}.input-container[_ngcontent-%COMP%]   .pin-input[_ngcontent-%COMP%]{width:100%;padding:16px 14px;font-size:16px;color:#1a1a1a;background-color:#fafafa;border:1px solid #d1d5db;border-radius:8px;box-sizing:border-box;transition:border-color .2s ease;outline:none}.input-container[_ngcontent-%COMP%]   .pin-input[_ngcontent-%COMP%]:focus{border-color:#3264d6;background-color:#fff}.input-container[_ngcontent-%COMP%]   .pin-input[_ngcontent-%COMP%]::placeholder{color:#999}.input-container[_ngcontent-%COMP%]   .pin-input[_ngcontent-%COMP%]:disabled{background-color:#f3f4f6;color:#a1a1aa}.pwd-screen[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;padding:66px 20px 24px;box-sizing:border-box}.back-btn[_ngcontent-%COMP%]{background:none;border:none;padding:4px;cursor:pointer;align-self:flex-start;margin-bottom:32px;color:#111827}.pwd-screen__user[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:40px}.pwd-screen__avatar[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;background:#6d28d9;color:#fff;font-size:14px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0}.pwd-screen__name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#111827}.input-container--pwd[_ngcontent-%COMP%]{position:relative}.input-container--pwd[_ngcontent-%COMP%]   .pin-input[_ngcontent-%COMP%]{padding-right:44px}.input-container--pin[_ngcontent-%COMP%]{position:relative}.input-container--pin[_ngcontent-%COMP%]   .pin-input[_ngcontent-%COMP%]{padding-right:44px}.eye-btn[_ngcontent-%COMP%]{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;padding:4px;display:flex;align-items:center}.continue-btn[_ngcontent-%COMP%]{width:100%;padding:16px;font-size:16px;font-weight:600;color:#fff;background-color:#3264d6;border:none;border-radius:8px;cursor:pointer;transition:background-color .2s ease}.continue-btn[_ngcontent-%COMP%]:disabled{background-color:#a0bbf0;cursor:not-allowed}.continue-btn[_ngcontent-%COMP%]:active:not(:disabled){background-color:#244fb2}"]})};export{D as Login};
