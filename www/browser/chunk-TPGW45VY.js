import{a as j,b as F,c as R}from"./chunk-CNGJ4UW6.js";import"./chunk-26UHM24F.js";import{a as q}from"./chunk-UJDEHUIQ.js";import{b as H}from"./chunk-TUA2I5ZM.js";import"./chunk-2I42IO6W.js";import{a as $}from"./chunk-OXRYSMMR.js";import{$ as C,A as r,D as b,I as G,J as c,K as p,L as A,N as T,O as V,P as E,Q as g,R as _,S as D,T as o,U as a,V as m,W as I,X as v,Y as N,Z as h,_ as Y,aa as d,ba as k,ca as f,ha as B,ma as O,n as S,o as M,p as y,q as s,r as P,s as z,ta as L,u}from"./chunk-WGFYM5RO.js";import"./chunk-2NFLSA4Y.js";function J(e,i){e&1&&(s(),o(0,"svg",6),m(1,"path",17),a())}function K(e,i){e&1&&(s(),o(0,"svg",7),m(1,"path",18)(2,"path",19),a())}function X(e,i){e&1&&(s(),o(0,"svg",7),m(1,"path",20),a())}function Z(e,i){if(e&1&&(s(),o(0,"svg",21),m(1,"rect",22)(2,"path",23),a(),P(),o(3,"span",24),d(4),a()),e&2){let n=h();r(4),k(n.order.assigneeName)}}function ee(e,i){e&1&&(s(),o(0,"svg",25),m(1,"circle",26)(2,"path",27)(3,"path",28),a(),P(),o(4,"span",29),d(5,"Assign"),a())}function te(e,i){if(e&1&&(o(0,"span",12),s(),o(1,"svg",30),m(2,"path",31),a(),d(3),a()),e&2){let n=h();r(3),f(" ",n.order.tag," ")}}function ne(e,i){e&1&&(s(),o(0,"svg",15),m(1,"circle",32)(2,"path",33)(3,"path",34),a())}function ie(e,i){e&1&&(s(),o(0,"svg",15),m(1,"path",35),a())}function re(e,i){if(e&1&&(o(0,"span",13),c(1,ne,4,0,":svg:svg",15),c(2,ie,2,0,":svg:svg",15),d(3),a()),e&2){let n=h();r(),p(n.order.tag==="Inspection"?1:-1),r(),p(n.order.tag==="Delivery Order"?2:-1),r(),f(" ",n.order.tag," ")}}function oe(e,i){if(e&1&&(o(0,"span",14),s(),o(1,"svg",36),m(2,"path",17),a(),d(3),a()),e&2){let n=h();r(3),f(" Started at ",n.order.timeAgo," ")}}function ae(e,i){if(e&1&&(o(0,"span",10),s(),o(1,"svg",37),m(2,"path",38)(3,"path",39),a(),d(4),a()),e&2){let n=h();r(4),f(" ",n.order.timeAgo," ")}}function de(e,i){if(e&1&&(o(0,"span",10),s(),o(1,"svg",40),m(2,"path",41),a(),d(3),a()),e&2){let n=h();r(3),f(" ",n.order.attachments," ")}}function le(e,i){e&1&&(o(0,"span",10),s(),o(1,"svg",42),m(2,"rect",43)(3,"path",44),a()())}function se(e,i){if(e&1&&(m(0,"hr",45),o(1,"div",46)(2,"span",47),d(3),o(4,"span",48),s(),o(5,"svg",49),m(6,"path",50),a(),d(7),a()()()),e&2){let n=h();r(3),f(" ",n.order.assigneeName," "),r(4),f(" ",n.order.assigneeExtra," ")}}var w=class e{order;cardClicked=new z;onCardClick(){this.cardClicked.emit(this.order.id)}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=b({type:e,selectors:[["app-service-order-card"]],inputs:{order:"order"},outputs:{cardClicked:"cardClicked"},decls:29,vars:33,consts:[["role","button","tabindex","0",1,"order-card",3,"click","keydown.enter","keydown.space"],[1,"order-card__top"],[1,"order-card__titles"],[1,"order-card__location"],[1,"order-card__task"],[1,"action-btn"],["width","22","height","22","viewBox","0 0 24 24","fill","white"],["width","22","height","22","viewBox","0 0 24 24","fill","none"],[1,"order-card__assignee-row"],[1,"order-card__badges"],[1,"badge"],[1,"dot"],[1,"badge","badge--escalated"],[1,"badge","badge--neutral"],[1,"badge","badge--started"],["width","13","height","13","viewBox","0 0 24 24","fill","none","stroke","#374151","stroke-width","1.8","stroke-linecap","round"],["d","M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],["d","M8 5l11 7-11 7V5z"],["d","M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9","stroke","white","stroke-width","1.8","stroke-linecap","round","stroke-linejoin","round"],["d","M13.73 21a2 2 0 01-3.46 0","stroke","white","stroke-width","1.8","stroke-linecap","round"],["d","M5 12h14","stroke","white","stroke-width","2.4","stroke-linecap","round"],["width","14","height","14","viewBox","0 0 24 24","fill","none"],["x","3","y","3","width","18","height","18","rx","3","stroke","#1d4ed8","stroke-width","1.8"],["d","M8 12h8M12 8v8","stroke","#1d4ed8","stroke-width","1.8","stroke-linecap","round"],[1,"order-card__assignee-name"],["width","16","height","16","viewBox","0 0 24 24","fill","none"],["cx","12","cy","8","r","4","stroke","#1d4ed8","stroke-width","1.8"],["d","M4 20c0-4 3.58-7 8-7s8 3 8 7","stroke","#1d4ed8","stroke-width","1.8","stroke-linecap","round"],["d","M18 11v6M15 14h6","stroke","#1d4ed8","stroke-width","1.8","stroke-linecap","round"],[1,"order-card__assign-link"],["width","13","height","13","viewBox","0 0 24 24","fill","#dc2626"],["d","M13 2L3 14h9l-1 8 10-12h-9l1-8z"],["cx","11","cy","11","r","7"],["d","M20 20l-3-3"],["d","M8 11h6M11 8v6"],["d","M5 8h14M5 8a2 2 0 00-2 2v6a2 2 0 002 2h14a2 2 0 002-2v-6a2 2 0 00-2-2M5 8V6a2 2 0 012-2h10a2 2 0 012 2v2"],["width","12","height","12","viewBox","0 0 24 24","fill","#16a34a"],["width","13","height","13","viewBox","0 0 24 24","fill","none","stroke","#374151","stroke-width","1.8"],["d","M12 8v4l3 3","stroke-linecap","round"],["d","M3.05 12a9 9 0 1017.9 0A9 9 0 003.05 12z"],["width","13","height","13","viewBox","0 0 24 24","fill","none","stroke","#374151","stroke-width","1.8","stroke-linecap","round","stroke-linejoin","round"],["d","M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"],["width","13","height","13","viewBox","0 0 24 24","fill","none","stroke","#374151","stroke-width","1.8","stroke-linejoin","round"],["x","9","y","9","width","11","height","11","rx","2"],["d","M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1","stroke-linecap","round"],[1,"order-card__divider"],[1,"order-card__footer"],[1,"order-card__footer-name"],[1,"order-card__crown"],["width","12","height","12","viewBox","0 0 24 24","fill","#f59e0b"],["d","M3 17l3-8 6 5 6-5 3 8H3z"]],template:function(n,t){n&1&&(o(0,"div",0),N("click",function(){return t.onCardClick()})("keydown.enter",function(){return t.onCardClick()})("keydown.space",function(){return t.onCardClick()}),o(1,"div",1)(2,"div",2)(3,"span",3),d(4),a(),o(5,"span",4),d(6),a()(),o(7,"button",5),c(8,J,2,0,":svg:svg",6),c(9,K,3,0,":svg:svg",7),c(10,X,2,0,":svg:svg",7),a()(),o(11,"div",8),c(12,Z,5,1)(13,ee,6,0),a(),o(14,"div",9)(15,"span",10),m(16,"span",11),d(17),a(),c(18,te,4,1,"span",12),c(19,re,4,3,"span",13),c(20,oe,4,1,"span",14)(21,ae,5,1,"span",10),o(22,"span",10),s(),o(23,"svg",15),m(24,"path",16),a(),d(25),a(),c(26,de,4,1,"span",10),c(27,le,4,0,"span",10),a(),c(28,se,8,2),a()),n&2&&(r(4),k(t.order.location),r(2),k(t.order.taskTitle),r(),C("action-btn--play",t.order.actionState==="play")("action-btn--bell",t.order.actionState==="bell")("action-btn--minus",t.order.actionState==="minus"),G("aria-label",t.order.actionState),r(),p(t.order.actionState==="play"?8:-1),r(),p(t.order.actionState==="bell"?9:-1),r(),p(t.order.actionState==="minus"?10:-1),r(2),p(t.order.assigneeName?12:13),r(3),C("badge--red",t.order.priorityColor==="red")("badge--orange",t.order.priorityColor==="orange")("badge--green",t.order.priorityColor==="green"),r(),C("dot--red",t.order.priorityColor==="red")("dot--orange",t.order.priorityColor==="orange")("dot--green",t.order.priorityColor==="green"),r(),f(" ",t.order.priority," "),r(),p(t.order.tagVariant==="escalated"?18:-1),r(),p(t.order.tagVariant==="neutral"?19:-1),r(),p(t.order.actionState==="play"?20:21),r(5),f(" ",t.order.orderType," "),r(),p(t.order.attachments>0?26:-1),r(),p(t.order.hasCopy?27:-1),r(),p(t.order.assigneeName&&t.order.assigneeExtra?28:-1))},dependencies:[O],styles:["[_nghost-%COMP%]{display:block}.order-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:14px 14px 10px;box-shadow:0 1px 4px #00000012;cursor:pointer;transition:transform .12s ease,box-shadow .12s ease}.order-card[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 6px 14px #0000001f}.order-card[_ngcontent-%COMP%]:active{transform:scale(.995)}.order-card__top[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;margin-bottom:6px}.order-card__titles[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;flex:1;min-width:0}.order-card__location[_ngcontent-%COMP%]{font-size:var(--font-size-lg);font-weight:var(--font-weight-bold);color:#111827;line-height:1.2}.order-card__task[_ngcontent-%COMP%]{font-size:var(--font-size-md);color:#374151;font-weight:var(--font-weight-regular);line-height:1.3}.action-btn[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}.action-btn--play[_ngcontent-%COMP%]{background:#16a34a;border:3px solid #bbf7d0}.action-btn--bell[_ngcontent-%COMP%]{background:#1e3a5f}.action-btn--minus[_ngcontent-%COMP%]{background:#7c3aed}.order-card__assignee-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;margin-bottom:8px}.order-card__assignee-name[_ngcontent-%COMP%], .order-card__assign-link[_ngcontent-%COMP%]{font-size:var(--font-size-md);font-weight:var(--font-weight-semibold);color:#1d4ed8}.order-card__badges[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:8px}.badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;font-size:var(--font-size-sm);color:#374151;font-weight:var(--font-weight-medium)}.badge--red[_ngcontent-%COMP%]{color:#dc2626}.badge--orange[_ngcontent-%COMP%]{color:#d97706}.badge--green[_ngcontent-%COMP%]{color:#16a34a}.badge--escalated[_ngcontent-%COMP%]{color:#dc2626}.badge--started[_ngcontent-%COMP%]{color:#16a34a}.badge--neutral[_ngcontent-%COMP%]{color:#374151}.dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;flex-shrink:0;display:inline-block}.dot--red[_ngcontent-%COMP%]{background:#dc2626}.dot--orange[_ngcontent-%COMP%]{background:#f59e0b}.dot--green[_ngcontent-%COMP%]{background:#16a34a}.order-card__divider[_ngcontent-%COMP%]{border:none;border-top:1px solid #f3f4f6;margin:10px 0 8px}.order-card__footer[_ngcontent-%COMP%]{display:flex;align-items:center}.order-card__footer-name[_ngcontent-%COMP%]{font-size:var(--font-size-md);font-weight:var(--font-weight-semibold);color:#111827;display:flex;align-items:center;gap:5px}.order-card__crown[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:3px;font-size:var(--font-size-sm);font-weight:var(--font-weight-medium);color:#374151}"],changeDetection:0})};var ce=()=>[],pe=(e,i)=>i.id;function me(e,i){e&1&&(g(0,"div",12),D(1,"div",13)(2,"div",14)(3,"div",15),_())}function ge(e,i){if(e&1&&(g(0,"div",10),d(1,"Loading orders\u2026"),_(),g(2,"div",11),T(3,me,4,0,"div",12,A),_()),e&2){let n=h();r(3),V(n.skeletonRows)}}function he(e,i){if(e&1){let n=I();g(0,"app-service-order-card",17),v("cardClicked",function(l){M(n);let x=h(2);return y(x.openDetail(l))}),_()}if(e&2){let n=i.$implicit;E("order",n)}}function _e(e,i){if(e&1&&(g(0,"div",5),T(1,he,1,1,"app-service-order-card",16,pe),_()),e&2){let n=h();r(),V(n.orders())}}function fe(e,i){if(e&1){let n=I();g(0,"app-quick-actions-sheet",18),v("closed",function(){M(n);let l=h();return y(l.fabSheetOpen.set(!1))}),_()}if(e&2){let n=h();E("items",n.fabActions)}}var Q=class e{authService=S(H);soService=S($);router=S(L);profileSvc=S(q);fabSheetOpen=u(!1);fabActions=[{title:"Create New Order",subtitle:"Log a fresh service request."},{title:"Escalate Priority",subtitle:"Mark selected order as urgent."},{title:"Assign Technician",subtitle:"Route to available staff quickly."}];orders=u([]);loading=u(!0);refreshing=u(!1);pullDistance=u(0);pullThreshold=64;skeletonRows=[1,2,3];pullStartY=0;ngOnInit(){this.fetchOrders(!0)}fetchOrders(i=!1){i&&this.loading.set(!0),this.soService.getOrders().subscribe({next:n=>{this.orders.set(n),i&&this.loading.set(!1),this.refreshing()&&setTimeout(()=>this.refreshing.set(!1),350)},error:()=>{this.loading.set(!1),this.refreshing.set(!1)}})}onTouchStart(i){if(this.isOverlayGesture(i)){this.pullStartY=0;return}let n=this.getScroller();if(!n||n.scrollTop>0||this.loading()||this.refreshing()){this.pullStartY=0;return}this.pullStartY=i.touches[0]?.clientY??0}onTouchMove(i){if(!this.pullStartY||this.isOverlayGesture(i))return;let n=this.getScroller();if(!n||n.scrollTop>0)return;let l=(i.touches[0]?.clientY??this.pullStartY)-this.pullStartY;l<=0||(this.pullDistance.set(Math.min(90,l*.45)),i.preventDefault())}onTouchEnd(){this.pullDistance()>=this.pullThreshold&&!this.refreshing()&&(this.refreshing.set(!0),this.fetchOrders(!1)),this.pullDistance.set(0),this.pullStartY=0}getScroller(){return document.querySelector(".shell__content")}isOverlayGesture(i){let n=i.target;return n?!!n.closest(".qa-sheet, .sheet, .qa-backdrop, .backdrop, app-page-header, app-page-toolbar"):!1}openDetail(i){this.router.navigate(["/shell/service-orders",i])}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=b({type:e,selectors:[["app-service-orders"]],decls:13,vars:13,consts:[[1,"so",3,"touchstart","touchmove","touchend","touchcancel"],["title","All Work","rolePillLabel","List",3,"avatarClicked","roleOptions","showHelpIcon","avatarInitials"],["sortLabel","Sort by Priority",3,"filterClicked","sortClicked"],[1,"pull-refresh"],[1,"so__count"],[1,"so__list"],["aria-label","Open quick actions",1,"fab",3,"click"],["width","22","height","22","viewBox","0 0 24 24","fill","none"],["d","M12 5v14M5 12h14","stroke","currentColor","stroke-width","2.2","stroke-linecap","round"],["title","Service Order Actions","subtitle","Take action without leaving this screen.",3,"items"],[1,"so__loading"],[1,"so__skeleton-list"],[1,"so__skeleton-card"],[1,"sk","sk--title"],[1,"sk","sk--line"],[1,"sk","sk--line","short"],[3,"order"],[3,"cardClicked","order"],["title","Service Order Actions","subtitle","Take action without leaving this screen.",3,"closed","items"]],template:function(n,t){n&1&&(g(0,"div",0),v("touchstart",function(x){return t.onTouchStart(x)})("touchmove",function(x){return t.onTouchMove(x)})("touchend",function(){return t.onTouchEnd()})("touchcancel",function(){return t.onTouchEnd()}),g(1,"app-page-header",1),v("avatarClicked",function(){return t.profileSvc.open()}),_(),g(2,"app-page-toolbar",2),v("filterClicked",function(){return null})("sortClicked",function(){return null}),_(),g(3,"div",3),d(4),_(),g(5,"div",4),d(6),_(),c(7,ge,5,0),c(8,_e,3,0,"div",5),g(9,"button",6),v("click",function(){return t.fabSheetOpen.set(!0)}),s(),g(10,"svg",7),D(11,"path",8),_()(),c(12,fe,1,1,"app-quick-actions-sheet",9),_()),n&2&&(r(),E("roleOptions",B(12,ce))("showHelpIcon",!1)("avatarInitials",t.authService.userInitials()),r(2),Y("height",t.refreshing()?t.pullThreshold:t.pullDistance(),"px"),C("pull-refresh--ready",t.pullDistance()>=t.pullThreshold||t.refreshing()),r(),f(" ",t.refreshing()?"Refreshing orders\u2026":t.pullDistance()>=t.pullThreshold?"Release to refresh":"Pull to refresh"," "),r(2),f("",t.orders().length," orders"),r(),p(t.loading()||t.refreshing()?7:-1),r(),p(!t.loading()&&!t.refreshing()?8:-1),r(4),p(t.fabSheetOpen()?12:-1))},dependencies:[O,j,F,w,R],styles:['@charset "UTF-8";.so[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100%;background:var(--app-bg);font-family:inherit;padding-bottom:calc(88px + env(safe-area-inset-bottom,0px));position:relative}.pull-refresh[_ngcontent-%COMP%]{height:0;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:var(--font-size-sm);font-weight:var(--font-weight-medium);color:var(--app-text-muted);transition:height .16s ease;background:color-mix(in srgb,var(--app-primary) 8%,var(--app-bg))}.pull-refresh--ready[_ngcontent-%COMP%]{color:var(--app-primary)}.so__count[_ngcontent-%COMP%]{padding:10px 16px 6px;font-size:var(--font-size-lg);font-weight:var(--font-weight-semibold);color:var(--app-text-muted)}.so__loading[_ngcontent-%COMP%]{padding:32px 16px;text-align:center;font-size:var(--font-size-md);color:#9ca3af}.so__skeleton-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;padding:4px 12px 12px}.so__skeleton-card[_ngcontent-%COMP%]{background:var(--app-surface);border-radius:12px;padding:14px;box-shadow:0 1px 4px #00000012;display:flex;flex-direction:column;gap:8px}.sk[_ngcontent-%COMP%]{border-radius:8px;background:linear-gradient(90deg,#e5e7eb 25%,#f3f4f6 37%,#e5e7eb 63%);background-size:400% 100%;animation:_ngcontent-%COMP%_shimmer 1.2s linear infinite;height:14px}.sk--title[_ngcontent-%COMP%]{height:22px;width:52%}.sk--line[_ngcontent-%COMP%]{width:100%}.sk--line.short[_ngcontent-%COMP%]{width:68%}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:100% 0}to{background-position:-100% 0}}.so__list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;padding:4px 12px 12px}.fab[_ngcontent-%COMP%]{position:fixed;bottom:calc(76px + env(safe-area-inset-bottom,0px));right:20px;width:52px;height:52px;border-radius:50%;background:linear-gradient(145deg,#2563eb,#1d4ed8);border:1px solid rgba(255,255,255,.35);cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;box-shadow:0 10px 24px #2563eb59;transition:transform .14s ease,box-shadow .14s ease;-webkit-tap-highlight-color:transparent}.fab[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 12px 30px #2563eb6b}.fab[_ngcontent-%COMP%]:active{transform:scale(.96)}'],changeDetection:0})};export{Q as ServiceOrders};
